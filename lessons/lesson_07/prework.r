AP <- AirPassengers
AP
##      Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
## 1949 112 118 132 129 121 135 148 148 136 119 104 118
## 1950 115 126 141 135 125 149 170 170 158 133 114 140
## 1951 145 150 178 163 172 178 199 199 184 162 146 166
## 1952 171 180 193 181 183 218 230 242 209 191 172 194
## 1953 196 196 236 235 229 243 264 272 237 211 180 201
## 1954 204 188 235 227 234 264 302 293 259 229 203 229
## 1955 242 233 267 269 270 315 364 347 312 274 237 278
## 1956 284 277 317 313 318 374 413 405 355 306 271 306
## 1957 315 301 356 348 355 422 465 467 404 347 305 336
## 1958 340 318 362 348 363 435 491 505 404 359 310 337
## 1959 360 342 406 396 420 472 548 559 463 407 362 405
## 1960 417 391 419 461 472 535 622 606 508 461 390 432
plot(AP, ylab = "Pasajeros (1000's)", xlab = "Tiempo", 
     main = "Reserva de pasajeros aéreos internacionales", 
     sub = "Estados Unidos en el periodo 1949-1960")

# La función decompose estima tendencias y efectos estacionales usando un método de promedio móvil.
desc <- decompose(AP, type = 'multiplicative')
plot(desc)

# Estacionario en la Media

set.seed(22)
(serie <- rnorm(100, mean = 175, sd = 6))
##   [1] 171.9272 189.9111 181.0470 176.7569 173.7462 186.1486 174.6038 174.0234
##   [9] 173.8008 176.8034 170.4166 175.4918 179.4582 174.4959 170.2426 169.4671
##  [17] 180.1694 187.0177 180.6193 165.3056 171.5497 174.9762 170.9433 168.7022
##  [25] 171.7403 178.3369 176.5170 169.5891 179.9463 165.6383 178.2280 167.3899
##  [33] 178.8431 171.7854 168.8821 170.1527 175.3410 180.7013 168.2394 173.7930
##  [41] 173.6290 178.3523 179.4925 186.5092 181.0432 194.5201 174.0295 177.0025
##  [49] 167.9280 181.4656 169.0229 178.1622 166.0550 177.6482 183.5642 174.6023
##  [57] 184.6301 169.9131 181.2531 173.1631 170.2475 183.5300 174.0745 174.2099
##  [65] 169.6911 185.2807 175.9562 187.6301 173.2360 171.0471 172.0069 173.7904
##  [73] 172.4046 172.6412 177.0794 172.0790 170.0642 176.3172 187.7297 180.3915
##  [81] 181.5553 177.1474 171.2118 178.9220 185.0701 165.8284 178.5540 167.5595
##  [89] 167.3779 167.6794 178.7376 174.9324 177.6784 173.7639 177.4759 174.5850
##  [97] 173.0005 172.6124 171.9931 170.3636
plot(serie, type = "l", main = "")
abline(h = 175, lty = 2, col = 2, lwd = 2)



# Estacionario en la Varianza

set.seed(33)
(serie2 <- rnorm(100))
##   [1] -0.135924521 -0.040796970  1.010539007 -0.158262445 -2.156637503
##   [6]  0.498646835 -0.755244306  0.778585191  0.754577954 -1.099545613
##  [11]  0.167349961 -0.029283481  1.875845028  0.244634467  0.702153686
##  [16] -0.015085665 -0.143370080  0.320666578  0.122334080 -0.594665192
##  [21] -0.442394755  0.290503585  0.723653379  0.459573950  0.185105160
##  [26]  0.233805005  0.593338262  2.001166926 -1.837197758 -0.862390941
##  [31]  1.582887396  0.155200689 -0.275019336  0.787675758 -0.222988089
##  [36]  1.392023729 -0.488652910  0.137377602  0.003508096 -0.726885772
##  [41] -0.721432863 -0.190524592  1.335229412  0.355995577  0.842759563
##  [46]  0.774532574  0.080459477 -0.672642017  1.835522538 -0.207207497
##  [51] -0.539590377 -1.500801138  0.267898146  0.034226769 -0.995273072
##  [56] -0.770300573 -0.578080916 -0.932968261 -2.176994702 -0.514110268
##  [61]  0.089118269  0.294490124  0.692191930 -1.611655882  0.187900801
##  [66]  0.077396006 -0.173813736 -1.399389895 -0.369176833  0.451220217
##  [71]  1.625998398  1.923297796 -0.163086182 -0.438784042  1.191499704
##  [76]  1.669939126  1.133191742 -1.517483089  2.731166189  0.499273851
##  [81] -1.491927108  0.921739067 -0.516714768  2.105302773 -0.886971084
##  [86] -0.167809931  0.909351016 -1.394613389  0.813745606 -0.957306865
##  [91] -0.369830329  1.478837218 -0.604142152 -0.290600172 -1.784421443
##  [96]  2.258065155 -0.666978957  0.477939312 -1.161075813 -0.380279312
plot(serie2, type = "l", main = "")
abline(h = 2, lty = 2, col = 4, lwd = 2)
abline(h = -2, lty = 2, col = 4, lwd = 2)


# Ruido Blanco


set.seed(1)
(w <- rnorm(100))
##   [1] -0.626453811  0.183643324 -0.835628612  1.595280802  0.329507772
##   [6] -0.820468384  0.487429052  0.738324705  0.575781352 -0.305388387
##  [11]  1.511781168  0.389843236 -0.621240581 -2.214699887  1.124930918
##  [16] -0.044933609 -0.016190263  0.943836211  0.821221195  0.593901321
##  [21]  0.918977372  0.782136301  0.074564983 -1.989351696  0.619825748
##  [26] -0.056128740 -0.155795507 -1.470752384 -0.478150055  0.417941560
##  [31]  1.358679552 -0.102787727  0.387671612 -0.053805041 -1.377059557
##  [36] -0.414994563 -0.394289954 -0.059313397  1.100025372  0.763175748
##  [41] -0.164523596 -0.253361680  0.696963375  0.556663199 -0.688755695
##  [46] -0.707495157  0.364581962  0.768532925 -0.112346212  0.881107726
##  [51]  0.398105880 -0.612026393  0.341119691 -1.129363096  1.433023702
##  [56]  1.980399899 -0.367221476 -1.044134626  0.569719627 -0.135054604
##  [61]  2.401617761 -0.039240003  0.689739362  0.028002159 -0.743273209
##  [66]  0.188792300 -1.804958629  1.465554862  0.153253338  2.172611670
##  [71]  0.475509529 -0.709946431  0.610726353 -0.934097632 -1.253633400
##  [76]  0.291446236 -0.443291873  0.001105352  0.074341324 -0.589520946
##  [81] -0.568668733 -0.135178615  1.178086997 -1.523566800  0.593946188
##  [86]  0.332950371  1.063099837 -0.304183924  0.370018810  0.267098791
##  [91] -0.542520031  1.207867806  1.160402616  0.700213650  1.586833455
##  [96]  0.558486426 -1.276592208 -0.573265414 -1.224612615 -0.473400636
plot(w, type = "l", main = "Ruido Blanco Gaussiano", 
     ylab = "w", xlab = "Tiempo")

# Función de autocorrelación muestral para ruido blanco Gaussiano

acf(w, main = "")
title("Función de autocorrelación muestral")


# Caminata Aleatoria

set.seed(2)
x <- w <- rnorm(100)
for(t in 2:100) x[t] <- x[t-1] + w[t]
x
##   [1] -0.89691455 -0.71206536  0.87577997 -0.25459571 -0.33484746 -0.20242718
##   [7]  0.50552755  0.26582953  2.25030346  2.11151645  2.52916720  3.51091998
##  [13]  3.11822463  2.07855565  3.86078461  1.54971552  2.42832010  2.46412682
##  [19]  3.47695552  3.90922067  6.00003987  4.80011406  6.38975226  8.34440390
##  [25]  8.34934167  5.89763529  6.37487259  5.77831442  6.57051769  6.86015440
##  [31]  7.59909300  7.91805341  8.99421776  8.71006004  7.93338477  7.33772427
##  [37]  5.61174449  4.70916001  4.15009809  3.90358553  3.51999930  1.56089612
##  [43]  0.71919106  2.62273853  3.24523246  5.23615289  4.93066917  4.83982493
##  [49]  4.65566348  3.45689572  2.61860857  4.68490993  4.12266287  5.39837838
##  [55]  4.35080576  2.38492752  2.06195642  2.99781895  4.13704875  5.80866752
##  [61]  4.02042531  6.05166783  5.34852350  5.50668826  6.01292306  5.19292795
##  [67]  3.19408096  2.71478837  2.79896827  1.90348166  0.98220599  1.31265550
##  [73]  1.17099469  1.60584245  1.55211982  0.64500945  1.94852168  2.72031146
##  [79]  3.77283705  2.36279871  3.35878330  1.66301840  1.12964626 -0.24262320
##  [85] -2.45054297 -0.62842046 -1.28181387 -1.56649509 -1.95344469 -1.56674972
##  [91]  0.03364114  1.71479609  0.53118970 -0.82726755 -2.33993834 -3.59304324
##  [97] -1.63368617 -1.62604029 -2.46865549 -3.06981560
plot(x, type = "l", main = "Caminata Aleatoria Simulada", 
     xlab = "Tiempo", ylab = "x")


diff(x)
##  [1]  0.184849185  1.587845331 -1.130375674 -0.080251757  0.132420284
##  [6]  0.707954729 -0.239698024  1.984473937 -0.138787012  0.417650751
## [11]  0.981752777 -0.392695356 -1.039668977  1.782228960 -2.311069085
## [16]  0.878604581  0.035806718  1.012828692  0.432265155  2.090819205
## [21] -1.199925820  1.589638200  1.954651642  0.004937777 -2.451706388
## [26]  0.477237303 -0.596558169  0.792203270  0.289636710  0.738938604
## [31]  0.318960401  1.076164354 -0.284157720 -0.776675274 -0.595660499
## [36] -1.725979779 -0.902584480 -0.559061915 -0.246512567 -0.383586228
## [41] -1.959103175 -0.841705060  1.903547467  0.622493930  1.990920436
## [46] -0.305483725 -0.090844235 -0.184161452 -1.198767765 -0.838287148
## [51]  2.066301356 -0.562247053  1.275715512 -1.047572627 -1.965878241
## [56] -0.322971094  0.935862527  1.139229803  1.671618767 -1.788242207
## [61]  2.031242519 -0.703144333  0.158164763  0.506234797 -0.819995106
## [66] -1.998846995 -0.479292591  0.084179904 -0.895486611 -0.921275666
## [71]  0.330449503 -0.141660809  0.434847762 -0.053722626 -0.907110376
## [76]  1.303512232  0.771789776  1.052525595 -1.410038341  0.995984590
## [81] -1.695764903 -0.533372143 -1.372269451 -2.207919779  1.822122519
## [86] -0.653393411 -0.284681219 -0.386949604  0.386694975  1.600390852
## [91]  1.681154956 -1.183606388 -1.358457254 -1.512670795 -1.253104899
## [96]  1.959357077  0.007645872 -0.842615198 -0.601160105
length(diff(x))
## [1] 99


plot(diff(x), type = "l", main = "Serie de diferencias",
     xlab = "Tiempo", ylab = "Diferencias")

acf(diff(x), main = "")
title("Correlograma de la serie de diferencias")


# Proceso autorregresivo

set.seed(1)
x <- w <- rnorm(100)
for(t in 2:100) x[t] <- 0.7 * x[t-1] + w[t]
x
##   [1] -0.626453811 -0.254874343 -1.014040653  0.885452345  0.949324413
##   [6] -0.155941295  0.378270146  1.003113807  1.277961017  0.589184325
##  [11]  1.924210196  1.736790373  0.594512681 -1.798541011 -0.134047789
##  [16] -0.138767062 -0.113327206  0.864507166  1.426376212  1.592364669
##  [21]  2.033632640  2.205679149  1.618540388 -0.856373425  0.020364351
##  [26] -0.041873694 -0.185107093 -1.600327349 -1.598379199 -0.700923879
##  [31]  0.868032836  0.504835258  0.741056292  0.464934364 -1.051605502
##  [36] -1.151118415 -1.200072844 -0.899364388  0.470470301  1.092504959
##  [41]  0.600229875  0.166799232  0.813722838  1.126269185  0.099632735
##  [46] -0.637752242 -0.081844608  0.711241699  0.385522977  1.150973811
##  [51]  1.203787548  0.230624890  0.502557115 -0.777573116  0.888722521
##  [56]  2.602505663  1.454532488 -0.025961885  0.551546308  0.251027812
##  [61]  2.577337229  1.764896057  1.925166603  1.375618781  0.219659938
##  [66]  0.342554256 -1.565170650  0.369935407  0.412208123  2.461157356
##  [71]  2.198319678  0.828877344  1.190940494 -0.100439286 -1.323940900
##  [76] -0.635312395 -0.888010549 -0.620502033 -0.360010099 -0.841528015
##  [81] -1.157738344 -0.945595456  0.516170178 -1.162247676 -0.219627186
##  [86]  0.179211341  1.188547776  0.527799520  0.739478474  0.784733722
##  [91]  0.006793575  1.212623308  2.009238931  2.106680902  3.061510086
##  [96]  2.701543485  0.614488231 -0.143123652 -1.324799171 -1.400760056
plot(x, type = "l", xlab = "", ylab = "")
title(main = "Proceso AR(1) simulado",
      xlab = "Tiempo",
      ylab = "x")

# Correlograma

acf(x, main = "")
title(main = "Correlograma del proceso AR(1) simulado")



# Install.packages('rhoR')
# library('rhoR')

plot(0:10, rho(0:10, 0.7), type = "h", ylab = "", xlab = "")
title(main = "Correlograma para un proceso AR(1)",R
      ylab = expression(rho[k] == 0.7^k),
      xlab = "lag k")



# Correlograma parcial muestral del proceso AR(1) con parámetro a=0.7

pacf(x, main = "")
title(main = "Correlograma Parcial del proceso AR(1) simulado")


# Proceso de promedios móviles



set.seed(1)
b <- c(0.8, 0.6, 0.4)
x <- w <- rnorm(100)
for(t in 4:100){
  for(j in 1:3) x[t] <- x[t] + b[j]*w[t-j]
}
x
##   [1] -0.62645381  0.18364332 -0.83562861  0.78638238  1.17781258  0.06605487
##   [7]  0.66687133  0.76779003  1.13071119  0.79320314  1.90826915  1.64634768
##  [13]  0.47554735 -1.87307394 -0.86363605 -0.72230504 -0.26305855  1.35389620
##  [19]  1.54860256  1.81070390  2.26436563  2.20214747  1.48922098 -1.09282698
##  [25] -0.61406210 -0.72405317 -0.62454373 -1.38113573 -1.77068076 -0.90934812
##  [31]  0.81784181  1.04366083  1.28782578  0.73813143 -1.22861571 -1.39385659
##  [37] -1.57404335 -1.17456592  0.65000286  1.44989203  1.08230687  0.51293504
##  [43]  0.70083017  0.89640745  0.07340822 -0.64571644 -0.39200230  0.36019912
##  [49]  0.43823124  1.39818330  1.34299750  0.19018446  0.44280520 -1.06444083
##  [55]  0.48939448  2.58564888  1.62516742  0.42353761  0.30623900 -0.45264827
##  [61]  2.21775200  2.02890929  2.04529618  1.51689675 -0.32272387 -0.11312923
##  [67] -2.08868785 -0.16244595  0.31823897  2.45256381  2.89177281  1.03532953
##  [73]  1.19711959 -0.68128060 -1.91845427 -1.02762852 -1.33595398 -0.68011377
##  [79] -0.07417102 -0.70670143 -0.99523855 -0.91408964  0.49293449 -0.88967187
##  [85]  0.02787350  0.36520204  1.07640113  0.98364464  0.89771172  0.80584342
##  [91] -0.22850328  1.08211858  1.90802436  2.13624841  3.32639307  2.71224243
##  [97]  0.40238246 -0.62471394 -2.22578570 -2.30768686
plot(x, type = "l", ylab = "x", xlab = "Tiempo",
     main = "Serie de tiempo simulada de un proceso MA(3)")


acf(x, main = "")
title(main = "Correlograma para un proceso MA(3) simulado")

# Autocorrelaciones Teóricas

rho <- function(k, beta){
  q <- length(beta) - 1
  if(k > q) ACF <- 0 else {
    s1 <- 0; s2 <- 0
    for(i in 1:(q-k+1)) s1 <- s1 + beta[i]*beta[i + k]
    for(i in 1:(q+1)) s2 <- s2 + beta[i]^2
    ACF <- s1/s2}
  ACF}


beta <- c(1, 0.8, 0.6, 0.4)
rho.k <- rep(1, 10)
for(k in 1:10) rho.k[k] <- rho(k, beta)

plot(0:10, c(1, rho.k), ylab = expression(rho[k]), xlab = "lag k", type = "h",
     main = "Función de autocorrelación para un proceso MA(3)")
abline(0, 0)


# Ajuste de modelos MA

x.ma <- arima(x, order = c(0, 0, 3))
x.ma
## 
## Call:
## arima(x = x, order = c(0, 0, 3))
## 
## Coefficients:
##          ma1     ma2     ma3  intercept
##       0.8054  0.6147  0.4161     0.3011
## s.e.  0.0924  0.1074  0.1028     0.2495
## 
## sigma^2 estimated as 0.7921:  log likelihood = -130.79,  aic = 271.57


# Proceso autorregresivo y de promedios móviles


set.seed(1)
x <- arima.sim(n = 100, list(ar = -0.6, ma = 0.5))
x
## Time Series:
## Start = 1 
## End = 100 
## Frequency = 1 
##   [1]  1.334912951 -0.283415921  0.131392485  0.856905588  0.778995948
##   [6]  0.537114350  0.893659422  0.705429333  0.042375534 -1.977494524
##  [11]  0.811646615 -0.233203834 -0.043937576 -1.522287592 -0.300153692
##  [16]  0.358958748  1.352275083 -0.234813001  0.477165549 -0.146268564
##  [21] -1.316200939 -0.313803778 -0.413504968 -0.008355393  1.075381909
##  [26]  0.667959289 -0.183711295 -0.225396701  0.705520556  0.481832553
##  [31] -0.699523627 -0.632158828  0.390129681  0.716746097 -0.158127408
##  [36]  0.919811065  0.286773104 -0.585037316  0.386128884 -1.190480581
##  [41]  1.582630502  1.747333448 -0.425421596 -0.972492407  0.631147758
##  [46] -0.228883445  2.471420526 -0.321283438  0.862889424 -0.144861814
##  [51] -0.642355041  0.202568720 -1.832103711  1.662337774 -0.111371895
##  [56]  2.316061477  0.172178478 -0.575498753  0.601052390 -0.989365889
##  [61] -1.127062683  0.340867145 -0.502089042  0.080712841  0.026466296
##  [66] -0.568230062 -0.522491169 -0.106018280  1.174108657 -1.638988496
##  [71]  0.815555885  0.140589934  1.145221063 -0.459766643  0.493786834
##  [76]  0.155836096 -0.502472293  1.238091166  1.021481819  0.667525866
##  [81]  1.536424760  0.430048297 -1.255377974 -0.458334734 -1.236244482
##  [86] -0.343960255 -0.650690842  0.122347040 -0.963271936  0.280531110
##  [91] -0.743888924  1.886328302  0.468554130  0.987395490  0.246835179
##  [96]  1.726167652 -0.830349005 -0.281303554  1.370242006 -0.756700438
plot(x, type = "l", xlab = "")
title(main = "Serie simulada", xlab = "Tiempo")


coef(arima(x, order = c(1, 0, 1)))
##        ar1        ma1  intercept 
## -0.6341000  0.5204297  0.1285681





